name: Draft Release Notes

"on":
  push:
    branches:
      - main

  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  update_release_draft:
    name: ‚úèÔ∏è Draft Release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: üóìÔ∏è Generate CalVer version
        id: calver
        run: |
          latest_tag="$(git tag --sort=committerdate | tail -1)"
          prefix="$(date +'%Y.%m')"

          if [[ "$latest_tag" =~ "$prefix".* ]]; then
              patch="$(echo "$latest_tag" | cut -d . -f 3)"
              ((patch=patch+1))
              version="$prefix.$patch"
          else
              version="$prefix.0"
          fi
          echo "version=$version" >> "$GITHUB_OUTPUT"

      - name: ‚úèÔ∏è Run Release Drafter
        uses: release-drafter/release-drafter@v6.0.0
        with:
          tag: ${{ steps.calver.outputs.version }}
          name: ${{ steps.calver.outputs.version }}
          version: ${{ steps.calver.outputs.version }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
